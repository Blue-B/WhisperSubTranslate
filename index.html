<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WhisperSubTranslate</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      padding: 15px;
      background-color: #f2f4f7;
      color: #212529;
    }
    /* 상단 UI 언어 드롭다운 */
    .ui-lang-top { position: fixed; top: 8px; right: 12px; z-index: 3000; }
    .ui-lang-top select { min-width: 100px; padding: 4px 8px; font-size: 12px; border: 1px solid #343a40; border-radius: 4px; background: #ffffff; color: #212529; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .container { 
      max-width: 1200px; 
      margin: 48px auto 0;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 8px 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
    .form-group { margin-bottom: 12px; }
    .row { display: flex; gap: 15px; align-items: flex-start; }
    .col { flex: 1; }
    .col-auto { flex: 0 0 auto; }
    label { 
      display: block; 
      margin-bottom: 5px; 
      font-weight: 600; 
      color: #212529;
      font-size: 13px;
    }
    select, input, button { 
      padding: 8px 10px; 
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px;
      transition: all 0.2s;
    }
    select, input {
      width: 100%;
      background: white;
    }
    select:focus, input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
    }
    button { 
      background-color: #007bff; 
      color: white; 
      border: none; 
      cursor: pointer;
      font-weight: 500;
      min-width: 120px;
    }
    button:hover { background-color: #0056b3; }
    button:disabled { 
      background-color: #6c757d; 
      cursor: not-allowed; 
      opacity: 0.6;
    }
    .btn-success { background-color: #28a745; }
    .btn-success:hover { background-color: #218838; }
    .btn-secondary { background-color: #6c757d; }
    .btn-secondary:hover { background-color: #545b62; }
    .btn-danger { background-color: #dc3545; }
    .btn-danger:hover { background-color: #c82333; }
    .progress-container { margin: 12px 0; }
    .progress-bar { 
      width: 100%; 
      height: 8px; 
      background-color: #e9ecef; 
      border-radius: 4px; 
      overflow: hidden; 
    }
    .progress-fill { 
      height: 100%; 
      background-color: #007bff; 
      width: 0%; 
      transition: width 0.3s ease;
    }
    .progress-text { 
      text-align: center; 
      margin-top: 8px; 
      font-size: 14px;
      color: #212529;
    }
    #output { 
      background-color: #f8f9fa; 
      padding: 10px; 
      border-radius: 4px; 
      max-height: 300px; 
      overflow-y: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
      line-height: 1.3;
      border: 1px solid #ced4da;
    }
    .status-info {
      font-size: 12px;
      color: #495057;
      margin-top: 5px;
      line-height: 1.4;
    }
    .dropzone {
      border: 2px dashed #007bff;
      padding: 20px 15px;
      text-align: center;
      border-radius: 6px;
      background-color: #f8f9ff;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 0;
      height: 210px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .dropzone:hover {
      border-color: #0056b3;
      background-color: #e7f1ff;
    }
    .dropzone.dragover {
      border-color: #0056b3;
      background-color: #e7f1ff;
      transform: scale(1.02);
    }
    .queue-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #dee2e6;
      height: 220px;
      display: flex;
      flex-direction: column;
    }
    .queue-list {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
      max-height: 150px;
    }
    .queue-item {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 6px 8px;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      min-height: 32px;
    }
    .queue-item.processing {
      border-color: #ffc107;
      background-color: #fff3cd;
    }
    .queue-item.completed {
      border-color: #28a745;
      background-color: #d4edda;
    }
    .queue-item.error {
      border-color: #dc3545;
      background-color: #f8d7da;
    }
    .file-info {
      flex: 1;
    }
    .file-name {
      font-weight: 600;
      color: #495057;
      margin-bottom: 2px;
      font-size: 13px;
    }
    .file-path {
      font-size: 10px;
      color: #6c757d;
      word-break: break-all;
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .file-status {
      font-size: 10px;
      color: #6c757d;
      margin-top: 1px;
    }
    .btn-group {
      display: flex;
      gap: 8px;
    }
    .btn-sm {
      padding: 6px 12px;
    }
    .btn-xs { padding: 4px 8px; font-size: 11px; }
    .gap-4 { gap: 4px; }
  </style>
</head>
<body>
  <!-- 상단 고정: 인터페이스 언어 드롭다운 -->
  <div class="ui-lang-top">
    <select id="uiLanguageSelect" title="UI Language">
      <option value="ko" selected>한국어</option>
      <option value="en">English</option>
      <option value="ja">日本語</option>
      <option value="zh">中文</option>
    </select>
  </div>

  <div class="container">
    <!-- 헤더 타이틀 제거로 세로 공간 절약 -->

    <!-- 파일 선택 및 대기열을 한 줄로 배치 -->
    <div class="row form-group">
      <!-- 파일 드래그앤드롭 영역 -->
      <div class="col">
        <div id="dropZone" class="dropzone">
          <h4 id="dropTitle" style="margin: 0 0 8px 0; color: #007bff; font-weight: 600; font-size: 14px;">파일 드래그 & 드롭</h4>
          <p id="dropHint1" style="margin: 8px 0; font-size: 14px; color: #6c757d;">동영상 파일을 여기에 드래그하세요</p>
          <p id="dropHint2" style="margin: 5px 0; font-size: 12px; color: #6c757d;">지원 형식: MP4, AVI, MKV, MOV, WMV</p>
          <button id="selectFileBtn" class="btn-success" style="margin-top: 10px;">파일 선택</button>
        </div>
      </div>
      
      <!-- 대기열 표시 -->
      <div class="col" id="queueContainer" style="display: none;">
        <div class="queue-section">
          <h4 id="queueTitle" style="margin: 0 0 8px 0; font-weight: 600; font-size: 14px; color: #495057;">처리 대기열</h4>
          <div id="queueList" class="queue-list">
            <!-- 대기열 항목들이 여기에 표시됩니다 -->
          </div>
          <div class="btn-group">
            <button id="stopBtn" class="btn-secondary btn-sm" style="display: none;">중지</button>
            <button id="clearQueueBtn" class="btn-secondary btn-sm">대기열 삭제</button>
            <button id="openFolderBtn" class="btn-secondary btn-sm">출력 폴더</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 모델 선택과 언어 선택을 한 행에 배치 -->
    <div class="row form-group">
      <div class="col">
        <label for="modelSelect" id="labelModel">모델 선택</label>
        <select id="modelSelect"></select>
        <div id="modelStatus" class="status-info">모델 상태를 확인하는 중...</div>
      </div>
      <div class="col">
        <label for="languageSelect" id="labelLanguage">언어 선택</label>
        <select id="languageSelect">
          <option value="auto" selected>자동 감지 (각 파일별로 자동 판별)</option>
          <option value="ko">한국어</option>
          <option value="en">영어</option>
          <option value="ja">일본어</option>
          <option value="zh">중국어</option>
          <option value="es">스페인어</option>
          <option value="fr">프랑스어</option>
          <option value="de">독일어</option>
          <option value="it">이탈리아어</option>
          <option value="pt">포르투갈어</option>
          <option value="ru">러시아어</option>
          <option value="hu">헝가리어</option>
          <option value="ar">아랍어</option>
        </select>
        <div id="langStatusInfo" class="status-info">
          <strong>자동 감지 권장:</strong> 각 동영상의 언어를 자동으로 판별합니다<br>
          <strong>고정 언어:</strong> 모든 파일을 동일한 언어로 처리합니다
        </div>
      </div>
    </div>

    <!-- 디바이스 선택 -->
    <div class="row form-group">
      <div class="col">
        <label for="deviceSelect" id="labelDevice">처리 장치 선택</label>
        <select id="deviceSelect">
          <option value="auto" selected>자동 (GPU 있으면 GPU, 없으면 CPU)</option>
          <option value="cuda">GPU (CUDA) - 빠른 처리</option>
          <option value="cpu">CPU - 안정적 처리</option>
        </select>
        <div id="deviceStatus" class="status-info">
          <strong>GPU 권장:</strong> NVIDIA GPU가 있으면 훨씬 빠른 처리 가능<br>
          <strong>CPU:</strong> GPU가 없거나 메모리 부족 시 안정적
        </div>
      </div>
      <div class="col">
        <label for="translationSelect" id="labelTranslation">번역 설정</label>
        <select id="translationSelect">
          <option value="none" selected>번역 안함</option>
          <option value="mymemory">MyMemory (일 5만글자 무료, 추천)</option>
          <option value="deepl">DeepL (월 50만글자, API키 필요)</option>
          <option value="chatgpt">ChatGPT (사용자 API 키 필요)</option>
        </select>
        <div id="translationStatus" class="status-info">
          <strong>MyMemory 추천:</strong> 완전 무료, 안정적인 번역<br>
          <strong>일일 5만글자</strong> 무료 (약 5시간 분량)
        </div>
        <!-- 인터페이스 언어 드롭다운은 상단 고정 영역으로 이동 -->
        <div class="form-group" style="margin-top:8px;" id="targetLanguageGroup">
          <label id="labelTargetLanguage" for="targetLanguageSelect">번역 대상 언어</label>
          <select id="targetLanguageSelect">
            <option value="ko" selected>한국어 (ko)</option>
            <option value="en">영어 (en)</option>
            <option value="ja">일본어 (ja)</option>
            <option value="zh">중국어 (zh)</option>
            <option value="es">스페인어 (es)</option>
            <option value="fr">프랑스어 (fr)</option>
            <option value="de">독일어 (de)</option>
            <option value="it">이탈리아어 (it)</option>
            <option value="pt">포르투갈어 (pt)</option>
            <option value="ru">러시아어 (ru)</option>
            <option value="hu">헝가리어 (hu)</option>
            <option value="ar">아랍어 (ar)</option>
          </select>
          <div id="targetLangNote" class="status-info">번역을 사용할 때만 적용됩니다.</div>
        </div>
      </div>
    </div>

    <!-- API 키 설정 버튼 -->
    <div class="form-group">
      <div class="row">
        <div class="col">
          <button id="runBtn" class="btn-success" style="font-size: 16px; padding: 12px 30px;">자막 추출 시작</button>
        </div>
        <div class="col-auto">
          <button id="apiSettingsBtn" class="btn-secondary" style="padding: 12px 20px;">API 키 설정</button>
        </div>
      </div>
    </div>

    <div class="progress-container" id="progressContainer" style="display: none;">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">준비 중...</div>
    </div>

    <h3 id="logTitle">처리 로그</h3>
    <pre id="output"></pre>
  </div>

  <!-- API 키 설정 모달 -->
  <div id="apiModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; width: 500px; max-width: 90vw;">
      <h3 id="apiModalTitle" style="margin-top: 0; color: #495057;">번역 API 키 설정</h3>
      
      <div class="form-group">
        <label id="labelDeeplKey" for="deeplApiKey">DeepL API 키 (선택사항)</label>
        <input type="password" id="deeplApiKey" placeholder="DeepL API 키를 입력하세요 (무료 50만글자/월)">
        <div id="deeplHelp" class="status-info">
          <strong>무료 가입 방법:</strong><br>
          1. <a href="https://www.deepl.com/ko/pro-api" target="_blank">DeepL API 페이지</a> 접속<br>
          2. "API 무료로 시작하기" 클릭<br>
          3. 이메일 인증 후 API 키 복사<br>
          4. 월 50만글자 무료 사용!
        </div>
      </div>
      
      <div class="form-group">
        <label id="labelOpenaiKey" for="openaiApiKey">OpenAI API 키 (선택사항)</label>
        <input type="password" id="openaiApiKey" placeholder="ChatGPT API 키를 입력하세요">
        <div class="status-info">
          <a id="openaiLink" href="https://platform.openai.com/api-keys" target="_blank">OpenAI API 키 발급 받기</a>
          <span id="openaiHelpSuffix"> (유료, 매우 저렴)</span>
        </div>
      </div>
      
      <div id="apiKeyStatus" style="margin: 15px 0; padding: 10px; border-radius: 4px; display: none;"></div>
      
      <div style="text-align: right; margin-top: 20px;">
        <button id="testApiKeysBtn" class="btn-secondary" style="margin-right: 10px;">연결 테스트</button>
        <button id="saveApiKeysBtn" class="btn-success" style="margin-right: 10px;">저장</button>
        <button id="cancelApiBtn" class="btn-secondary">취소</button>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
